<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Microservicios y Clean Architecture en Ruby on Rails</title>
    <style>
        @media print {
            body { margin: 0; }
            .no-print { display: none; }
            .page-break { page-break-before: always; }
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .container {
            background: white;
            padding: 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #e74c3c;
            padding-bottom: 10px;
            font-size: 2.2em;
        }
        
        h2 {
            color: #34495e;
            margin-top: 30px;
            border-left: 4px solid #3498db;
            padding-left: 15px;
            font-size: 1.8em;
        }
        
        h3 {
            color: #555;
            margin-top: 20px;
            font-size: 1.4em;
        }
        
        h4 {
            color: #666;
            margin-top: 15px;
            font-size: 1.1em;
        }
        
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            color: #e74c3c;
        }
        
        pre {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 0.85em;
            line-height: 1.4;
        }
        
        pre code {
            background: none;
            color: #ecf0f1;
            padding: 0;
        }
        
        ul, ol {
            margin-left: 20px;
        }
        
        li {
            margin: 8px 0;
        }
        
        .diagram {
            background: #ecf0f1;
            padding: 20px;
            border-radius: 5px;
            font-family: monospace;
            margin: 20px 0;
            overflow-x: auto;
        }
        
        .highlight {
            background: #fff3cd;
            padding: 15px;
            border-left: 4px solid #ffc107;
            margin: 15px 0;
        }
        
        .button-container {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: #e8f4f8;
            border-radius: 5px;
        }
        
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        button:hover {
            background: #2980b9;
        }
        
        .metadata {
            color: #7f8c8d;
            font-size: 0.9em;
            margin-bottom: 30px;
            padding: 10px;
            background: #ecf0f1;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="button-container no-print">
            <button onclick="window.print()">ğŸ“„ Descargar como PDF</button>
            <p style="margin-top: 10px; color: #666;">
                Usa Ctrl+P (Windows) o Cmd+P (Mac) y selecciona "Guardar como PDF"
            </p>
        </div>

        <h1>Microservicios y Clean Architecture en Ruby on Rails</h1>
        
        <div class="metadata">
            <strong>GuÃ­a Completa</strong><br>
            Fecha: Diciembre 2025
        </div>

        <h2>1. Â¿QuÃ© son los Microservicios?</h2>
        
        <p>Los <strong>microservicios</strong> son un estilo arquitectÃ³nico donde una aplicaciÃ³n se construye como un conjunto de servicios pequeÃ±os e independientes, cada uno ejecutÃ¡ndose en su propio proceso y comunicÃ¡ndose mediante mecanismos ligeros (generalmente HTTP/REST o mensajerÃ­a).</p>

        <h3>CaracterÃ­sticas principales:</h3>
        <ul>
            <li><strong>Independencia:</strong> Cada servicio puede desarrollarse, desplegarse y escalarse de forma independiente</li>
            <li><strong>Responsabilidad Ãºnica:</strong> Cada microservicio se enfoca en una capacidad de negocio especÃ­fica</li>
            <li><strong>DescentralizaciÃ³n:</strong> Base de datos propia por servicio (idealmente)</li>
            <li><strong>Resiliencia:</strong> Si un servicio falla, no necesariamente cae toda la aplicaciÃ³n</li>
            <li><strong>TecnologÃ­a heterogÃ©nea:</strong> Cada servicio puede usar diferentes tecnologÃ­as</li>
        </ul>

        <h3>Ejemplo prÃ¡ctico:</h3>
        <p>En lugar de tener una aplicaciÃ³n monolÃ­tica de e-commerce, tendrÃ­as:</p>
        <ul>
            <li>Servicio de usuarios/autenticaciÃ³n</li>
            <li>Servicio de productos/catÃ¡logo</li>
            <li>Servicio de pedidos</li>
            <li>Servicio de pagos</li>
            <li>Servicio de notificaciones</li>
        </ul>

        <div class="page-break"></div>

        <h2>2. ComparaciÃ³n: Monolito vs Microservicios</h2>

        <h3>Arquitectura MonolÃ­tica:</h3>
        <div class="diagram">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Una sola aplicaciÃ³n Rails         â”‚
â”‚                                     â”‚
â”‚  - Usuarios                         â”‚
â”‚  - Productos                        â”‚
â”‚  - Pedidos                          â”‚
â”‚  - Pagos                            â”‚
â”‚                                     â”‚
â”‚  Todo corre en el mismo servidor    â”‚
â”‚  Puerto 3000                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        </div>
        <p><strong>Problema:</strong> Si necesitas actualizar el mÃ³dulo de pagos, debes redesplegar TODA la aplicaciÃ³n.</p>

        <h3>Arquitectura de Microservicios:</h3>
        <div class="diagram">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Servicio Usuariosâ”‚  â”‚Servicio Productosâ”‚  â”‚ Servicio Pedidos â”‚  â”‚  Servicio Pagos  â”‚
â”‚                  â”‚  â”‚                  â”‚  â”‚                  â”‚  â”‚                  â”‚
â”‚ Rails App        â”‚  â”‚ Rails App        â”‚  â”‚ Rails App        â”‚  â”‚ Rails App        â”‚
â”‚ Puerto 3001      â”‚  â”‚ Puerto 3002      â”‚  â”‚ Puerto 3003      â”‚  â”‚ Puerto 3004      â”‚
â”‚ servidor-1       â”‚  â”‚ servidor-2       â”‚  â”‚ servidor-3       â”‚  â”‚ servidor-4       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                     â”‚                      â”‚                      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                              Se comunican via HTTP/REST
        </div>
        <p><strong>Ventaja:</strong> Puedes actualizar solo el servicio de Pagos sin tocar los demÃ¡s.</p>

        <div class="page-break"></div>

        <h2>3. Â¿QuÃ© es Clean Architecture?</h2>

        <p><strong>Clean Architecture</strong> (propuesta por Robert C. Martin "Uncle Bob") es un patrÃ³n arquitectÃ³nico que organiza el cÃ³digo en capas concÃ©ntricas, donde las dependencias apuntan hacia adentro, hacia las reglas de negocio.</p>

        <h3>Capas principales (de adentro hacia afuera):</h3>
        <ol>
            <li><strong>Entities (Entidades):</strong> Objetos de negocio puros, reglas que siempre son verdaderas</li>
            <li><strong>Use Cases (Casos de Uso):</strong> LÃ³gica de aplicaciÃ³n especÃ­fica, orquesta el flujo de datos</li>
            <li><strong>Interface Adapters (Adaptadores):</strong> Controladores, presentadores, gateways</li>
            <li><strong>Frameworks & Drivers:</strong> Rails, base de datos, web, UI</li>
        </ol>

        <h3>Principios clave:</h3>
        <ul>
            <li><strong>Independencia de frameworks:</strong> La lÃ³gica de negocio no depende de Rails</li>
            <li><strong>Testeable:</strong> Las reglas de negocio se pueden probar sin UI, BD, etc.</li>
            <li><strong>Independencia de UI:</strong> La UI puede cambiar sin afectar el negocio</li>
            <li><strong>Independencia de BD:</strong> Puedes cambiar de PostgreSQL a MongoDB sin afectar las reglas</li>
            <li><strong>Regla de dependencia:</strong> El cÃ³digo de capas externas puede depender de capas internas, nunca al revÃ©s</li>
        </ul>

        <div class="page-break"></div>

        <h2>4. Aplicando Clean Architecture en Rails</h2>

        <h3>Estructura de carpetas propuesta:</h3>
        <pre><code>app/
â”œâ”€â”€ controllers/          # Capa de Interface Adapters
â”œâ”€â”€ models/              # Tradicionalmente, pero lo reorganizamos
â”œâ”€â”€ core/                # Nueva carpeta para Clean Architecture
â”‚   â”œâ”€â”€ entities/        # Capa 1: Entidades de negocio
â”‚   â”œâ”€â”€ use_cases/       # Capa 2: Casos de uso
â”‚   â”œâ”€â”€ repositories/    # Capa 3: Interfaces para acceso a datos
â”‚   â””â”€â”€ services/        # Servicios de dominio
â”œâ”€â”€ infrastructure/      # Capa 4: Implementaciones concretas
â”‚   â”œâ”€â”€ repositories/
â”‚   â””â”€â”€ external_services/
â””â”€â”€ serializers/         # Presentadores/Formatters</code></pre>

        <h3>Ejemplo: Entity (Entidad de negocio pura)</h3>
        <pre><code># app/core/entities/order.rb
module Core
  module Entities
    class Order
      attr_reader :id, :customer_id, :items, :total, :status

      def initialize(id:, customer_id:, items:, status: 'pending')
        @id = id
        @customer_id = customer_id
        @items = items
        @status = status
        @total = calculate_total
      end

      def can_be_cancelled?
        ['pending', 'confirmed'].include?(status)
      end

      def cancel
        raise "Order cannot be cancelled" unless can_be_cancelled?
        @status = 'cancelled'
      end

      private

      def calculate_total
        items.sum { |item| item[:price] * item[:quantity] }
      end
    end
  end
end</code></pre>

        <div class="page-break"></div>

        <h3>Ejemplo: Use Case (Caso de uso)</h3>
        <pre><code># app/core/use_cases/create_order.rb
module Core
  module UseCases
    class CreateOrder
      def initialize(order_repository:, payment_gateway:, notification_service:)
        @order_repository = order_repository
        @payment_gateway = payment_gateway
        @notification_service = notification_service
      end

      def execute(customer_id:, items:)
        validate_inventory(items)

        order = Entities::Order.new(
          id: nil,
          customer_id: customer_id,
          items: items
        )

        payment_result = @payment_gateway.charge(
          amount: order.total,
          customer_id: customer_id
        )

        return failure("Payment failed") unless payment_result.success?

        saved_order = @order_repository.save(order)
        @notification_service.send_order_confirmation(saved_order)

        success(saved_order)
      end

      private

      def success(order)
        { success: true, order: order }
      end

      def failure(message)
        { success: false, error: message }
      end
    end
  end
end</code></pre>

        <div class="page-break"></div>

        <h2>5. Despliegue Independiente de Microservicios</h2>

        <p>Cada microservicio es literalmente una <strong>aplicaciÃ³n separada</strong> que:</p>
        <ul>
            <li>Tiene su propio cÃ³digo base (repositorio Git separado)</li>
            <li>Tiene su propia base de datos</li>
            <li>Se despliega en su propio contenedor/servidor/proceso</li>
            <li>Tiene su propia URL/puerto</li>
            <li>Puede actualizarse independientemente</li>
        </ul>

        <h3>OpciÃ³n 1: Servidores tradicionales separados</h3>
        <pre><code># Servidor 1 (IP: 192.168.1.10)
cd users_service
RAILS_ENV=production rails server -p 3000

# Servidor 2 (IP: 192.168.1.11)
cd orders_service
RAILS_ENV=production rails server -p 3000

# Servidor 3 (IP: 192.168.1.12)
cd products_service
RAILS_ENV=production rails server -p 3000</code></pre>

        <h3>OpciÃ³n 2: Docker (mÃ¡s comÃºn)</h3>
        <pre><code># docker-compose.yml
version: '3.8'

services:
  users_service:
    build: ./users_service
    ports:
      - "3001:3000"
    environment:
      - DATABASE_URL=postgresql://postgres:password@users_db:5432/users_production

  orders_service:
    build: ./orders_service
    ports:
      - "3003:3000"
    environment:
      - DATABASE_URL=postgresql://postgres:password@orders_db:5432/orders_production
      - USERS_SERVICE_URL=http://users_service:3000</code></pre>

        <h3>Comandos de despliegue independiente:</h3>
        <pre><code># Desplegar solo el servicio de usuarios
docker-compose up -d users_service

# Actualizar solo el servicio de pedidos
docker-compose build orders_service
docker-compose up -d orders_service</code></pre>

        <div class="page-break"></div>

        <h2>6. ComunicaciÃ³n entre Microservicios</h2>

        <h3>Cliente HTTP para comunicaciÃ³n:</h3>
        <pre><code># app/services/users_service_client.rb
class UsersServiceClient
  BASE_URL = ENV['USERS_SERVICE_URL'] || 'http://localhost:3001'

  def self.find_user(user_id)
    response = HTTP.get("#{BASE_URL}/api/v1/users/#{user_id}")
    
    if response.status.success?
      JSON.parse(response.body)
    else
      nil
    end
  rescue HTTP::Error => e
    Rails.logger.error("Error connecting to Users Service: #{e.message}")
    nil
  end
end</code></pre>

        <h3>API Gateway con Nginx:</h3>
        <pre><code># nginx.conf
upstream users_service {
    server users-service:3000;
}

upstream orders_service {
    server orders-service:3000;
}

server {
    listen 80;

    location /api/users/ {
        proxy_pass http://users_service/api/v1/users/;
    }

    location /api/orders/ {
        proxy_pass http://orders_service/api/v1/orders/;
    }
}</code></pre>

        <div class="page-break"></div>

        <h2>7. Ventajas y Consideraciones</h2>

        <h3>Ventajas de Microservicios:</h3>
        <ul>
            <li><strong>Actualizaciones sin downtime:</strong> Actualiza un servicio mientras los demÃ¡s siguen funcionando</li>
            <li><strong>Escalado selectivo:</strong> Si el servicio de pedidos recibe mucho trÃ¡fico, escala solo ese</li>
            <li><strong>TecnologÃ­as diferentes:</strong> Puedes tener usuarios en Rails, pagos en Node.js, etc.</li>
            <li><strong>Equipos independientes:</strong> Cada equipo puede trabajar en su servicio sin bloquear a otros</li>
            <li><strong>Fallos aislados:</strong> Si el servicio de notificaciones cae, el resto sigue funcionando</li>
        </ul>

        <h3>Ventajas de Clean Architecture:</h3>
        <ul>
            <li><strong>Testabilidad:</strong> Puedes testear casos de uso sin Rails, BD o HTTP</li>
            <li><strong>Flexibilidad:</strong> Cambiar de ActiveRecord a Sequel o MongoDB es mÃ¡s fÃ¡cil</li>
            <li><strong>Claridad:</strong> La lÃ³gica de negocio estÃ¡ separada de la infraestructura</li>
            <li><strong>Mantenibilidad:</strong> Cambios en una capa no afectan a otras</li>
        </ul>

        <h3>Consideraciones importantes:</h3>
        <div class="highlight">
            <h4>Para Microservicios:</h4>
            <ul>
                <li>Mayor complejidad operacional</li>
                <li>Necesitas infraestructura de monitoreo y logging distribuido</li>
                <li>Debugging mÃ¡s complejo</li>
                <li>Transacciones distribuidas son difÃ­ciles</li>
            </ul>

            <h4>Para Clean Architecture:</h4>
            <ul>
                <li>Overhead inicial: mÃ¡s cÃ³digo y abstracciÃ³n</li>
                <li>Curva de aprendizaje para el equipo</li>
                <li>Pragmatismo: no todas las apps necesitan este nivel</li>
                <li>Vas en contra de algunas convenciones de Rails</li>
            </ul>
        </div>

        <h3>Â¿CuÃ¡ndo usar estas arquitecturas?</h3>
        <ul>
            <li>Aplicaciones con lÃ³gica de negocio compleja</li>
            <li>Cuando necesitas cambiar tecnologÃ­as frecuentemente</li>
            <li>Equipos grandes con mÃºltiples dominios</li>
            <li>Cuando la testabilidad es crÃ­tica</li>
            <li>Cuando necesitas escalar diferentes partes independientemente</li>
        </ul>

        <p><strong>Nota:</strong> Para aplicaciones CRUD simples, el Rails tradicional puede ser suficiente. La clave es encontrar el balance entre pragmatismo y arquitectura sÃ³lida segÃºn las necesidades de tu proyecto.</p>

        <div class="page-break"></div>

        <h2>8. ConclusiÃ³n</h2>

        <p>Tanto los microservicios como Clean Architecture son patrones poderosos que pueden mejorar significativamente la mantenibilidad, escalabilidad y testabilidad de tus aplicaciones Ruby on Rails.</p>

        <p><strong>Puntos clave para recordar:</strong></p>
        <ul>
            <li>Los microservicios dividen tu aplicaciÃ³n en servicios independientes que se comunican vÃ­a APIs</li>
            <li>Clean Architecture separa la lÃ³gica de negocio de los detalles de implementaciÃ³n</li>
            <li>Cada patrÃ³n tiene su lugar: evalÃºa tu contexto antes de implementar</li>
            <li>Puedes combinar ambos enfoques para mÃ¡ximo beneficio</li>
            <li>Empieza simple y evoluciona segÃºn las necesidades</li>
        </ul>

        <div style="margin-top: 50px; padding: 20px; background: #e8f4f8; border-radius: 5px; text-align: center;">
            <p style="margin: 0; color: #2c3e50; font-size: 0.9em;">
                ğŸ“š Documento generado desde conversaciÃ³n con Claude<br>
                ğŸ’¡ Para mÃ¡s informaciÃ³n sobre arquitectura de software en Rails, consulta la documentaciÃ³n oficial
            </p>
        </div>
    </div>
</body>
</html>